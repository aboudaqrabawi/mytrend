{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _internals = _interopRequireDefault(require(\"../../../utils/internals\"));\n\nvar _events = require(\"../../../utils/events\");\n\nvar _utils = require(\"../../../utils\");\n\nvar _native = require(\"../../../utils/native\");\n\nvar PhoneAuthListener = function () {\n  function PhoneAuthListener(auth, phoneNumber, timeout, forceResend) {\n    (0, _classCallCheck2.default)(this, PhoneAuthListener);\n    this._auth = auth;\n    this._reject = null;\n    this._resolve = null;\n    this._promise = null;\n    this._credential = null;\n    this._timeout = timeout || 20;\n    this._forceResending = forceResend || false;\n    this._phoneAuthRequestKey = (0, _utils.generatePushID)();\n    this._internalEvents = {\n      codeSent: \"phone:auth:\" + this._phoneAuthRequestKey + \":onCodeSent\",\n      verificationFailed: \"phone:auth:\" + this._phoneAuthRequestKey + \":onVerificationFailed\",\n      verificationComplete: \"phone:auth:\" + this._phoneAuthRequestKey + \":onVerificationComplete\",\n      codeAutoRetrievalTimeout: \"phone:auth:\" + this._phoneAuthRequestKey + \":onCodeAutoRetrievalTimeout\"\n    };\n    this._publicEvents = {\n      error: \"phone:auth:\" + this._phoneAuthRequestKey + \":error\",\n      event: \"phone:auth:\" + this._phoneAuthRequestKey + \":event\",\n      success: \"phone:auth:\" + this._phoneAuthRequestKey + \":success\"\n    };\n\n    this._subscribeToEvents();\n\n    if (_utils.isAndroid) {\n      (0, _native.getNativeModule)(this._auth).verifyPhoneNumber(phoneNumber, this._phoneAuthRequestKey, this._timeout, this._forceResending);\n    }\n\n    if (_utils.isIOS) {\n      (0, _native.getNativeModule)(this._auth).verifyPhoneNumber(phoneNumber, this._phoneAuthRequestKey);\n    }\n  }\n\n  (0, _createClass2.default)(PhoneAuthListener, [{\n    key: \"_subscribeToEvents\",\n    value: function _subscribeToEvents() {\n      var events = Object.keys(this._internalEvents);\n\n      for (var i = 0, len = events.length; i < len; i++) {\n        var type = events[i];\n\n        _events.SharedEventEmitter.once(this._internalEvents[type], this[\"_\" + type + \"Handler\"].bind(this));\n      }\n    }\n  }, {\n    key: \"_addUserObserver\",\n    value: function _addUserObserver(observer) {\n      _events.SharedEventEmitter.addListener(this._publicEvents.event, observer);\n    }\n  }, {\n    key: \"_emitToObservers\",\n    value: function _emitToObservers(snapshot) {\n      _events.SharedEventEmitter.emit(this._publicEvents.event, snapshot);\n    }\n  }, {\n    key: \"_emitToErrorCb\",\n    value: function _emitToErrorCb(snapshot) {\n      var error = snapshot.error;\n      if (this._reject) this._reject(error);\n\n      _events.SharedEventEmitter.emit(this._publicEvents.error, error);\n    }\n  }, {\n    key: \"_emitToSuccessCb\",\n    value: function _emitToSuccessCb(snapshot) {\n      if (this._resolve) this._resolve(snapshot);\n\n      _events.SharedEventEmitter.emit(this._publicEvents.success, snapshot);\n    }\n  }, {\n    key: \"_removeAllListeners\",\n    value: function _removeAllListeners() {\n      var _this = this;\n\n      setTimeout(function () {\n        Object.values(_this._internalEvents).forEach(function (event) {\n          _events.SharedEventEmitter.removeAllListeners(event);\n        });\n        Object.values(_this._publicEvents).forEach(function (publicEvent) {\n          _events.SharedEventEmitter.removeAllListeners(publicEvent);\n        });\n      }, 0);\n    }\n  }, {\n    key: \"_promiseDeferred\",\n    value: function _promiseDeferred() {\n      var _this2 = this;\n\n      if (!this._promise) {\n        this._promise = new Promise(function (resolve, reject) {\n          _this2._resolve = function (result) {\n            _this2._resolve = null;\n            return resolve(result);\n          };\n\n          _this2._reject = function (possibleError) {\n            _this2._reject = null;\n            return reject(possibleError);\n          };\n        });\n      }\n    }\n  }, {\n    key: \"_codeSentHandler\",\n    value: function _codeSentHandler(credential) {\n      var snapshot = {\n        verificationId: credential.verificationId,\n        code: null,\n        error: null,\n        state: 'sent'\n      };\n\n      this._emitToObservers(snapshot);\n\n      if (_utils.isIOS) {\n        this._emitToSuccessCb(snapshot);\n      }\n\n      if (_utils.isAndroid) {}\n    }\n  }, {\n    key: \"_codeAutoRetrievalTimeoutHandler\",\n    value: function _codeAutoRetrievalTimeoutHandler(credential) {\n      var snapshot = {\n        verificationId: credential.verificationId,\n        code: null,\n        error: null,\n        state: 'timeout'\n      };\n\n      this._emitToObservers(snapshot);\n\n      this._emitToSuccessCb(snapshot);\n    }\n  }, {\n    key: \"_verificationCompleteHandler\",\n    value: function _verificationCompleteHandler(credential) {\n      var snapshot = {\n        verificationId: credential.verificationId,\n        code: credential.code || null,\n        error: null,\n        state: 'verified'\n      };\n\n      this._emitToObservers(snapshot);\n\n      this._emitToSuccessCb(snapshot);\n\n      this._removeAllListeners();\n    }\n  }, {\n    key: \"_verificationFailedHandler\",\n    value: function _verificationFailedHandler(state) {\n      var snapshot = {\n        verificationId: state.verificationId,\n        code: null,\n        error: null,\n        state: 'error'\n      };\n      var _state$error = state.error,\n          code = _state$error.code,\n          message = _state$error.message,\n          nativeErrorMessage = _state$error.nativeErrorMessage;\n      snapshot.error = (0, _utils.nativeToJSError)(code, message, {\n        nativeErrorMessage: nativeErrorMessage\n      });\n\n      this._emitToObservers(snapshot);\n\n      this._emitToErrorCb(snapshot);\n\n      this._removeAllListeners();\n    }\n  }, {\n    key: \"on\",\n    value: function on(event, observer, errorCb, successCb) {\n      if (!(0, _utils.isString)(event)) {\n        throw new Error(_internals.default.STRINGS.ERROR_MISSING_ARG_NAMED('event', 'string', 'on'));\n      }\n\n      if (event !== 'state_changed') {\n        throw new Error(_internals.default.STRINGS.ERROR_ARG_INVALID_VALUE('event', 'state_changed', event));\n      }\n\n      if (!(0, _utils.isFunction)(observer)) {\n        throw new Error(_internals.default.STRINGS.ERROR_MISSING_ARG_NAMED('observer', 'function', 'on'));\n      }\n\n      this._addUserObserver(observer);\n\n      if ((0, _utils.isFunction)(errorCb)) {\n        _events.SharedEventEmitter.once(this._publicEvents.error, errorCb);\n      }\n\n      if ((0, _utils.isFunction)(successCb)) {\n        _events.SharedEventEmitter.once(this._publicEvents.success, successCb);\n      }\n\n      return this;\n    }\n  }, {\n    key: \"then\",\n    value: function then(fn) {\n      this._promiseDeferred();\n\n      if (this._promise) return this._promise.then.bind(this._promise)(fn);\n      return undefined;\n    }\n  }, {\n    key: \"catch\",\n    value: function _catch(fn) {\n      this._promiseDeferred();\n\n      if (this._promise) return this._promise.catch.bind(this._promise)(fn);\n      return undefined;\n    }\n  }]);\n  return PhoneAuthListener;\n}();\n\nexports.default = PhoneAuthListener;","map":{"version":3,"sources":["/Users/alheresh/trend-mobile/my-trend-new/node_modules/react-native-firebase/dist/modules/auth/phone/PhoneAuthListener.js"],"names":["PhoneAuthListener","auth","phoneNumber","timeout","forceResend","_auth","_reject","_resolve","_promise","_credential","_timeout","_forceResending","_phoneAuthRequestKey","_internalEvents","codeSent","verificationFailed","verificationComplete","codeAutoRetrievalTimeout","_publicEvents","error","event","success","_subscribeToEvents","isAndroid","verifyPhoneNumber","isIOS","events","Object","keys","i","len","length","type","SharedEventEmitter","once","bind","observer","addListener","snapshot","emit","setTimeout","values","forEach","removeAllListeners","publicEvent","Promise","resolve","reject","result","possibleError","credential","verificationId","code","state","_emitToObservers","_emitToSuccessCb","_removeAllListeners","message","nativeErrorMessage","_emitToErrorCb","errorCb","successCb","Error","INTERNALS","STRINGS","ERROR_MISSING_ARG_NAMED","ERROR_ARG_INVALID_VALUE","_addUserObserver","fn","_promiseDeferred","then","undefined","catch"],"mappings":"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","sourcesContent":["import INTERNALS from '../../../utils/internals';\nimport { SharedEventEmitter } from '../../../utils/events';\nimport { generatePushID, isFunction, isAndroid, isIOS, isString, nativeToJSError } from '../../../utils';\nimport { getNativeModule } from '../../../utils/native';\nexport default class PhoneAuthListener {\n  /**\n   *\n   * @param auth\n   * @param phoneNumber\n   * @param timeout\n   * @param forceResend\n   */\n  constructor(auth, phoneNumber, timeout, forceResend) {\n    this._auth = auth;\n    this._reject = null;\n    this._resolve = null;\n    this._promise = null;\n    this._credential = null;\n    this._timeout = timeout || 20; // 20 secs\n\n    this._forceResending = forceResend || false;\n    this._phoneAuthRequestKey = generatePushID(); // internal events\n\n    this._internalEvents = {\n      codeSent: `phone:auth:${this._phoneAuthRequestKey}:onCodeSent`,\n      verificationFailed: `phone:auth:${this._phoneAuthRequestKey}:onVerificationFailed`,\n      verificationComplete: `phone:auth:${this._phoneAuthRequestKey}:onVerificationComplete`,\n      codeAutoRetrievalTimeout: `phone:auth:${this._phoneAuthRequestKey}:onCodeAutoRetrievalTimeout`\n    }; // user observer events\n\n    this._publicEvents = {\n      // error cb\n      error: `phone:auth:${this._phoneAuthRequestKey}:error`,\n      // observer\n      event: `phone:auth:${this._phoneAuthRequestKey}:event`,\n      // success cb\n      success: `phone:auth:${this._phoneAuthRequestKey}:success`\n    }; // setup internal event listeners\n\n    this._subscribeToEvents(); // start verification flow natively\n\n\n    if (isAndroid) {\n      getNativeModule(this._auth).verifyPhoneNumber(phoneNumber, this._phoneAuthRequestKey, this._timeout, this._forceResending);\n    }\n\n    if (isIOS) {\n      getNativeModule(this._auth).verifyPhoneNumber(phoneNumber, this._phoneAuthRequestKey);\n    }\n  }\n  /**\n   * Subscribes to all EE events on this._internalEvents\n   * @private\n   */\n\n\n  _subscribeToEvents() {\n    const events = Object.keys(this._internalEvents);\n\n    for (let i = 0, len = events.length; i < len; i++) {\n      const type = events[i];\n      SharedEventEmitter.once(this._internalEvents[type], // $FlowExpectedError: Flow doesn't support indexable signatures on classes: https://github.com/facebook/flow/issues/1323\n      this[`_${type}Handler`].bind(this));\n    }\n  }\n  /**\n   * Subscribe a users listener cb to the snapshot events.\n   * @param observer\n   * @private\n   */\n\n\n  _addUserObserver(observer) {\n    SharedEventEmitter.addListener(this._publicEvents.event, observer);\n  }\n  /**\n   * Send a snapshot event to users event observer.\n   * @param snapshot PhoneAuthSnapshot\n   * @private\n   */\n\n\n  _emitToObservers(snapshot) {\n    SharedEventEmitter.emit(this._publicEvents.event, snapshot);\n  }\n  /**\n   * Send a error snapshot event to any subscribed errorCb's\n   * @param snapshot\n   * @private\n   */\n\n\n  _emitToErrorCb(snapshot) {\n    const {\n      error\n    } = snapshot;\n    if (this._reject) this._reject(error);\n    SharedEventEmitter.emit(this._publicEvents.error, error);\n  }\n  /**\n   * Send a success snapshot event to any subscribed completeCb's\n   * @param snapshot\n   * @private\n   */\n\n\n  _emitToSuccessCb(snapshot) {\n    if (this._resolve) this._resolve(snapshot);\n    SharedEventEmitter.emit(this._publicEvents.success, snapshot);\n  }\n  /**\n   * Removes all listeners for this phone auth instance\n   * @private\n   */\n\n\n  _removeAllListeners() {\n    setTimeout(() => {\n      // move to next event loop - not sure if needed\n      // internal listeners\n      Object.values(this._internalEvents).forEach(event => {\n        SharedEventEmitter.removeAllListeners(event);\n      }); // user observer listeners\n\n      Object.values(this._publicEvents).forEach(publicEvent => {\n        SharedEventEmitter.removeAllListeners(publicEvent);\n      });\n    }, 0);\n  }\n  /**\n   * Create a new internal deferred promise, if not already created\n   * @private\n   */\n\n\n  _promiseDeferred() {\n    if (!this._promise) {\n      this._promise = new Promise((resolve, reject) => {\n        this._resolve = result => {\n          this._resolve = null;\n          return resolve(result);\n        };\n\n        this._reject = possibleError => {\n          this._reject = null;\n          return reject(possibleError);\n        };\n      });\n    }\n  }\n  /* --------------------------\n   --- INTERNAL EVENT HANDLERS\n   ---------------------------- */\n\n  /**\n   * Internal code sent event handler\n   * @private\n   * @param credential\n   */\n\n\n  _codeSentHandler(credential) {\n    const snapshot = {\n      verificationId: credential.verificationId,\n      code: null,\n      error: null,\n      state: 'sent'\n    };\n\n    this._emitToObservers(snapshot);\n\n    if (isIOS) {\n      this._emitToSuccessCb(snapshot);\n    }\n\n    if (isAndroid) {// android can auto retrieve so we don't emit to successCb immediately,\n      // if auto retrieve times out then that will emit to successCb\n    }\n  }\n  /**\n   * Internal code auto retrieve timeout event handler\n   * @private\n   * @param credential\n   */\n\n\n  _codeAutoRetrievalTimeoutHandler(credential) {\n    const snapshot = {\n      verificationId: credential.verificationId,\n      code: null,\n      error: null,\n      state: 'timeout'\n    };\n\n    this._emitToObservers(snapshot);\n\n    this._emitToSuccessCb(snapshot);\n  }\n  /**\n   * Internal verification complete event handler\n   * @param credential\n   * @private\n   */\n\n\n  _verificationCompleteHandler(credential) {\n    const snapshot = {\n      verificationId: credential.verificationId,\n      code: credential.code || null,\n      error: null,\n      state: 'verified'\n    };\n\n    this._emitToObservers(snapshot);\n\n    this._emitToSuccessCb(snapshot);\n\n    this._removeAllListeners();\n  }\n  /**\n   * Internal verification failed event handler\n   * @param state\n   * @private\n   */\n\n\n  _verificationFailedHandler(state) {\n    const snapshot = {\n      verificationId: state.verificationId,\n      code: null,\n      error: null,\n      state: 'error'\n    };\n    const {\n      code,\n      message,\n      nativeErrorMessage\n    } = state.error;\n    snapshot.error = nativeToJSError(code, message, {\n      nativeErrorMessage\n    });\n\n    this._emitToObservers(snapshot);\n\n    this._emitToErrorCb(snapshot);\n\n    this._removeAllListeners();\n  }\n  /* -------------\n   -- PUBLIC API\n   --------------*/\n\n\n  on(event, observer, errorCb, successCb) {\n    if (!isString(event)) {\n      throw new Error(INTERNALS.STRINGS.ERROR_MISSING_ARG_NAMED('event', 'string', 'on'));\n    }\n\n    if (event !== 'state_changed') {\n      throw new Error(INTERNALS.STRINGS.ERROR_ARG_INVALID_VALUE('event', 'state_changed', event));\n    }\n\n    if (!isFunction(observer)) {\n      throw new Error(INTERNALS.STRINGS.ERROR_MISSING_ARG_NAMED('observer', 'function', 'on'));\n    }\n\n    this._addUserObserver(observer);\n\n    if (isFunction(errorCb)) {\n      SharedEventEmitter.once(this._publicEvents.error, errorCb);\n    }\n\n    if (isFunction(successCb)) {\n      SharedEventEmitter.once(this._publicEvents.success, successCb);\n    }\n\n    return this;\n  }\n  /**\n   * Promise .then proxy\n   * @param fn\n   */\n\n\n  then(fn) {\n    this._promiseDeferred(); // $FlowFixMe: Unsure how to annotate `bind` here\n\n\n    if (this._promise) return this._promise.then.bind(this._promise)(fn);\n    return undefined; // will never get here - just to keep flow happy\n  }\n  /**\n   * Promise .catch proxy\n   * @param fn\n   */\n\n\n  catch(fn) {\n    this._promiseDeferred(); // $FlowFixMe: Unsure how to annotate `bind` here\n\n\n    if (this._promise) return this._promise.catch.bind(this._promise)(fn);\n    return undefined; // will never get here - just to keep flow happy\n  }\n\n}"]},"metadata":{},"sourceType":"script"}